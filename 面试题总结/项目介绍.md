# 机票直连项目

### 项目介绍

这个项目是让业务人员在网站上或者app上直接通过搜索出发地和目的地来实时查询机票信息，跟携程网站搜索机票类似，不过我们的实时机票信息是通过外部接口来进行查询的

### 我的工作

我的工作还是负责查询这一块，当时我们分为应用层和服务层，比如，机票服务，酒店服务，订单服务等。我做的这一块是机票服务，所以我需要向应用层提供接口

### 遇到的问题

当时项目规划后期可能在搜索机票的时候推荐一些酒店信息，一日游信息等，虽然前期只有搜索机票，但是后期逻辑会比较复杂，就考虑使用领域驱动设计这一设计理念。在领域驱动设计中有实体、值对象、领域服务、模块、聚合、工厂、仓库这些概念，所以我们也是这么划分的，

实体、值对象：也就是模型，但是他俩的区别在于实体是有标识的，值对象是没有的，实体是有具体的动作的，值对象是没有的。举个例子：订单模型，即便是两个订单具有相同的属性，但是他们的标识是不一样的订单号，那么就是两个不同的实体，但是值对象就像一个普通的物品，它只有颜色，大小，重量等一些属性。在机票服务中，航程方案就是一个实体，页面上搜索出来的就是一条条的航程方案，航程方案下面有许多动作，比如获取验仓验价，获取退改签信息等，而值对象就如：机场，飞机等，它们只是关联在航程方案下，只是一个信息

实体有：航程方案，航程方案价格，单个航程

值对象有：航线信息，机场信息，飞机信息，城市信息

领域服务：某些操作明显不属于实体，那么就需要放在服务中，类似于mvc中的controller,起到一个调度的作用

模块：我的理解就是就是一个个服务 比如，机票服务，酒店服务，订单服务等。如果写在一个大项目中，这些就是一个一个的模块，现在拆分出来成服务了

聚合：就是一组呆在一起的对象，但是聚合根必须是实体，不能是值对象

工厂：创建一个复杂的和聚合的地方

仓库：就是负责数据的查询和持久化，仓库的数据可以来自数据库,redis，远程等，在机票服务中，仓库的数据来自远程



# 酒店直连项目

### 项目介绍

这个项目是让业务人员能够在我们的网站上实时的酒店的信息，这些酒店信息并不是公司的采购人员采购的，而是获取的携程的酒店信息。

### 我的工作

我在这个项目中负责酒店信息的持久化和酒店信息的查询

### 遇到的问题

持久化：因为酒店房型和价格会经常变化的，所以携程每天都会推送过来很多新增、变化的、下架的酒店房型信息，我们公司当时是由java组负责外部对接，然后他们把一些没有用的信息做一些过滤，然后传给php。所以我的工作就是跟java对接，需要定时任务来处理这些数据，因为这些信息每天变化还是很多的，有全球几千家酒店信息变化，每个酒店又有几十个到几百个房型信息变化，我们这边要操作很多表，比如资源总表，酒店表，房型表，库存表，价格表等还有其他一些关联的表，所以处理的时间还是很长的，有时候会处理三四个小时（一般都是半夜执行），所以考虑到网络问题还有可能出现的异常问题，所以考虑使用消息中间件rabbitMQ,java组是发布者，我们是消费者，处理成功的删除原队列中的消息，处理失败的放入失败队列，然后白天来上班了再处理失败队列里面的信息，因为这些信息都是信息不全或者格式错误等情况造成的

查询：因为数据库中的房型信息很多，业务人员在搜索的时候一边都是模糊搜索名称的，所以考虑到业务的使用体验，就考虑用es来做搜索，之前没用用过es，所以就一边学，一边开发，我设计的mapping 是国家、城市、名称、id、类型、供应商，名称使用的ik_max_word作为分词器，搜索出来的是id，然后通过id来获取其他信息，这样就比较快，我们自己搭的是单服务器的，