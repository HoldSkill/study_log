

# shell学习笔记

### 1. shell介绍

我们常说的shell是shell脚本(shell script)的意思，是一种用shell语言编写的脚本程序

##### 1.1 shell环境

shell编程和php、javascript一样，只要一个用来编辑代码的问题本编辑器和脚本解释器就可以了

linux的shell解释器有很多：

- Bourne Shell（/usr/bin/sh或/bin/sh）
- Bourne Again Shell（/bin/bash）
- C Shell（/usr/bin/csh）
- K Shell（/usr/bin/ksh）
- Shell for Root（/sbin/sh）
- ……

这里我们使用`bash`，bash在日常工作中被广泛使用，而且也是大多数linux系统默认使用的shell解释器,

##### 1.2 编写第一个shell脚本

```bash
#告诉系统使用哪个解释器解释这个脚本
#!/bin/bash
# echo 是用于窗口输出
echo 'hello world!'
```

##### 1.3 执行shell脚本

执行shell有两种方法：

- **做为可执行程序**：修改脚本执行权限，通过`./test.sh`执行，如果不加`./`，linux会去PATH中寻找test.sh，通常情况下个人目录并不在PATH中，所以要告诉系统在当前目录下找test.sh
- **作为解释器的参数执行**：`/bin/sh test.sh`或者`/bin/bash test.sh`

### 2. shell变量

##### 2.1 变量的分类

shell分为三种变量:

- **局部变量**：局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。
- **环境变量**:所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量
- **shell变量**：是由shell程序设置的特殊变量，shell变量中有一部分是环境变量，一部分是局部变量

##### 2.2 变量的定义和使用

- **定义变量时，不需要加其他任何符号，但是在使用的时候需要用`$`,而且变量和`=`之间不能有空格**

  ```bash
  name='yangguang'
  echo $name
  ```

- 变量名最好加上`{}`花括号，使解释器区分变量和其他值，也可以提高代码的可读性，

  ```bash
  #不加引号也是可以的，但如果需要在引号中解析变量，就需要用到双引号，同php一样
  name=java
  echo ${name}script
  ```

- **只读变量**，需要用`readonly`关键字，只读变量不能被修改

  ```bash
  name=yang
  #注意！readonly的时候不能添加$
  readonly name
  #当修改变量的时候，运行时会提醒该变量只读
  ```

- **删除变量**，使用`unset`，

  ```bash
  name=yangguang
  #注意！unset的时候不能添加$
  unset name
  ```

##### 2.3 字符串变量

字符串变量的定义可以使用单引号，可以使用双引号，也可以不使用引号，单引号和双引号的区别同php

字符串变量常用用法:

- **获取字符串长度**

  ```bash
  string='baidu'
  echo ${#string} #输出5
  ```

- **截取字符串**

  ```bash
  string='baidu'
  echo ${string:1:4} #截取字符串从第一位到第四位，同php的substr
  ```

- 查找子字符串，

  ```bash
  string="runoob is a great site"
  #注意！这里是反引号，而不是单引号
  echo `expr index "$string" io`  # 输出 4
  ```

##### 2.4 数组变量

**shell支持一维数组，不支持多维数组，且不限制数组大小**

- **定义数组**

  ```bash
  #数组名=(值1 值2 值3 ...)
  #或者可以这样定义
  #数组名[0]=值1
  #数组名[1]=值2
  #数组名[2]=值3
  #也可以不使用连续的下标
  ```

- **获取数组**

  ```bash
  #${数组名[下标]}
  #@符可以代表所有的元素
  echo ${test_array[@]}
  ```

- **获取数组元素个数或者某个元素长度**

  ```bash
  # 取得数组元素的个数
  length=${#array_name[@]}
  # 或者
  length=${#array_name[*]}
  # 取得数组单个元素的长度
  lengthn=${#array_name[n]}
  ```

### 3. 向脚本内传递参数

我们可以向shell脚本中传入参数，脚本中获取参数的格式是`$n`，n为数字，0表示执行的文件名,1表示第一个参数，2表示第二个参数

```bash
echo "Shell 传递参数实例！";
echo "执行的文件名：$0";
echo "第一个参数为：$1";
echo "第二个参数为：$2";
echo "第三个参数为：$3";
```

另外，还有几个常用的特殊字符来处理参数

| 参数 | 说明                                 |
| ---- | ------------------------------------ |
| $#   | 获取所有传入参数个数                 |
| $*   | 以一个字符串的格式显示所有传入的参数 |
| $$   | 获取脚本运行的当前进程ID             |
| $!   | 后台运行的最后一个进程ID             |

### 4. shell基本运算符

shell支持的运算符：

- 算数运算符
- 关系运算符
- 布尔运算符
- 字符串运算符
- 文件测试运算符

##### 4.1 算术运算符

原生的 bash不支持算数运算，可以通过awk或者expr工具实现，常用的是expr工具

```bash
value1=1
value2=2
#注意！完整的表达式是被反引号包含，而不是单引号，而且运算符两边都需要有空格
echo `expr ${value1} + ${value2}` #输出3
```

常用的算数运算符

| 运算符 | 说明                                          | 举例                                       |
| :----- | :-------------------------------------------- | :----------------------------------------- |
| +      | 加法                                          | `expr $a + $b` 结果为 30。                 |
| -      | 减法                                          | `expr $a - $b` 结果为 -10。                |
| *      | 乘法                                          | `expr $a \* $b` 结果为  200。*需要被转义   |
| /      | 除法                                          | `expr $b / $a` 结果为 2。                  |
| %      | 取余                                          | `expr $b % $a` 结果为 0。                  |
| =      | 赋值                                          | a=$b 将把变量 b 的值赋给 a。不需要用到expr |
| ==     | 相等。用于比较两个数字，相同则返回 true。     | [ $a == $b ] 返回 false。不需要用到expr    |
| !=     | 不相等。用于比较两个数字，不相同则返回 true。 | [ $a != $b ] 返回 true。不需要用到expr     |



##### 4.2 关系运算符



